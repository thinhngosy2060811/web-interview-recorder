<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Interview Recorder</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/static/css/style.css">    
</head>
<body>
    <div id="app">
        <div id="step-token" style="display: block;">
            <h1>Web Interview Recorder</h1>
            <h2>Step 1: Authentication</h2>
            <label>Token: <input type="text" id="token"placeholder="Enter your token" autocomplete="off"></label>
            <label>Ho ten: <input type="text" id="userName" placeholder="Enter your name" autocomplete="off"></label>
            <button onclick="verifyAndStart()">Start</button>
            <p id="token-status" class="status-text"></p>
        </div>

        <div id="step-permission" style="display: none;">
            <h1>Web Interview Recorder</h1>
            <h2>Step 2: Permissions</h2>
            <p>Please grant access to your camera and microphone to continue.</p>
            <button onclick="requestPermissions()">Enable Camera & Microphone</button>
            <p id="permission-status" class="status-text"></p>
        </div>

        <div id="step-dashboard" class="step-box" style="display: none;">
            <h1>Candidate Dashboard</h1>
            <div style="text-align: right; margin-bottom: 10px;">
                <button onclick="location.reload()" style="background: #6c757d;">Logout</button>
            </div>
        
            <table class="dashboard-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date/Time</th>
                        <th>Priority</th>
                        <th>Note</th>
                        <th>Videos</th>
                    </tr>
                </thead>
                <tbody id="candidate-list">
                    <!-- D·ªØ li·ªáu s·∫Ω ƒë·ªï v√†o ƒë√¢y -->
                </tbody>
            </table>
        </div>
        <div id="step-admin-review" style="display: none;">
            <div style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <button onclick="backToDashboard()" style="background: #6c757d; padding: 8px 15px;">‚¨Ö Back to Dashboard</button>
                <span style="float: right; font-weight: bold; color: #555; margin-top: 5px;" id="review-candidate-name"></span>
            </div>
    
            <div id="review-videos-container"></div>
        </div>
        <div id="step-interview" style="display: none;">
            <h1>Web Interview Recorder</h1>
            <h2>Interview Session</h2>
            <p>Save folder: <strong id="folder-name"></strong></p>
            
            <div class="video-container">
                <video id="preview" width="640" height="480" autoplay muted></video>
                <canvas id="output_canvas" width="640" height="480"></canvas>
                <div id="mic-visualizer" style="display:none; position: absolute; bottom: 15px; left: 15px; width: 30px; height: 42px; z-index: 10;">
                    <svg viewBox="0 0 24 24" style="position: absolute; width: 100%; height: 100%; fill: rgba(255,255,255,0.5);">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                    <div id="mic-fill-mask" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; overflow: hidden; transition: height 0.1s;">
                        <svg viewBox="0 0 24 24" style="position: absolute; bottom: 0; left: 0; width: 30px; height: 42px; fill: #00e676;">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                        </svg>
                    </div>
                </div>
                <!--ƒê·ªìng h·ªì-->
                <div id="timer-display" class="timer-overlay">03:00</div>
            </div>
            
            <div id="ai-warning"></div>

            <div id="review-section" style="display: none;">
                <h3>üîπ Review your video</h3>
                <video id="review-player" width="640" height="480" controls></video>
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="confirmVideo()">‚úÖ Confirm & Upload</button>
                    <button onclick="cancelReview()">‚ùå Cancel & Retry</button>
                </div>
            </div>
            <div class="question-box">
                <h3>Question <span id="current-question-num">1</span>/5</h3>
                <p id="current-question-text" style="font-size: 1.1em; color: #333;"></p>
            </div>
            
            <p>Status: <strong id="recording-status">Ready</strong></p>
            <p id="upload-status" class="status-text"></p>
            
            <div class="button-group">
                <button id="btn-start-record" onclick="startRecording()">Start Recording</button>
                <button id="btn-stop-record" onclick="stopRecording()" disabled>Stop Recording</button>
                <button id="btn-next" onclick="nextQuestion()" disabled>Next Question</button>
                <button id="btn-retry-upload" onclick="retryUpload()" style="display: none; background: #ff9800;">
                    üîÑ Retry Upload
                </button>
            </div>
            <div>

        <div id="step-complete" style="display: none;">
            <h1>Completed!</h1>
            <h2>Thank you for completing the interview</h2>
            <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <p>Saved folder: <strong id="final-folder-name"></strong></p>
                <p>Questions answered: <strong id="total-questions"></strong></p>
            </div>
            <p>Your videos have been saved successfully. We will contact you soon!</p>
        </div>
    </div>
    <script src="/static/js/config.js"></script>

    <script src="/static/js/ai-engine.js"></script>

    <script src="/static/js/main.js"></script>

</body>
</html>